---
title: "Tracking Nitrate"
output: pdf_document
---

```{r}
library(ggplot2)
library(tidyverse)
library(dplyr)
library(emmeans)
library(lme4)
library(lmerTest)
library(multcomp)
```


```{r}
getwd()
data1= read.csv(file="Season_nitrate.csv")

data1 = data1 %>%
  mutate(Rep= as.factor(Rep))

str(data1)
```

```{r}
data1 = data1 %>%
  mutate(Timing = fct_recode(Timing,
                    "Fall" = "PP",
                    "Spring" = "GU",
                    "Harvest" = "PH"))

order = c("Fall", "Fall", "Fall", "Spring", "Spring", "Spring", "Harvest", "Harvest", "Harvest")
```


```{r}
data1 %>%
  ggplot(aes(x = Timing, y = N_ppm)) +
  geom_point() +
  facet_grid(rows = vars(Depth), cols = vars(County)) +
  coord_flip()
```

# Dane County
```{r}
#Dane = lmer(N_ppm ~ Timing*Depth + (1|Rep), data = (filter(data1, County == "Dane")))

#anova(Dane)
```

Based on what I understand, we're trying to test that there are differences in nitrate levels between sampling times for each depth separately.
```{r}
Dane12 = lmer(N_ppm ~ Timing + (1|Rep), data = (filter(data1, County == "Dane", Depth == "0-12")))
Dane24 = lmer(N_ppm ~ Timing + (1|Rep), data = (filter(data1, County == "Dane", Depth == "12-24")))
Dane36 = lmer(N_ppm ~ Timing + (1|Rep), data = (filter(data1, County == "Dane", Depth == "24-36")))
```

```{r}
anova(Dane12)
#significant differences based on timing

anova(Dane24)
#significant differences based on timing

anova(Dane36)
#significant differences based on timing
```

```{r}
Dane12_means = lsmeans(Dane12, ~ Timing, contr= "pairwise", adjust= "none")
Dane24_means = lsmeans(Dane24, ~ Timing, contr= "pairwise", adjust= "none")
Dane36_means = lsmeans(Dane36, ~ Timing, contr= "pairwise", adjust= "none")

Dane12_CLD = cld(Dane12_means$lsmeans,alpha=0.05, Letters=letters, sort=FALSE, reverse=FALSE)
Dane24_CLD = cld(Dane24_means$lsmeans,alpha=0.05, Letters=letters, sort=FALSE, reverse=FALSE)
Dane36_CLD = cld(Dane36_means$lsmeans,alpha=0.05, Letters=letters, sort=FALSE, reverse=FALSE)
```

```{r}
Dane12_CLD = Dane12_CLD %>%
  mutate(Depth = "0-12")

Dane24_CLD = Dane24_CLD %>%
  mutate(Depth = "12-24") 

Dane36_CLD = Dane36_CLD %>%
  mutate(Depth = "24-36")

Dane_CLD = rbind(Dane12_CLD, Dane24_CLD, Dane36_CLD)

Dane_CLD = as_tibble(Dane_CLD) %>% 
  rename(N_ppm = lsmean) %>%
  mutate(N_ppm = round(N_ppm,0),
         Timing = factor(Timing, c("Fall", "Spring", "Harvest")),
         Depth = factor(Depth, c("0-12", "12-24", "24-36")),
         Location = "Dane")
```

```{r}
Dane_N_PPM = Dane_CLD %>%
  ggplot(aes(x= Timing, y= N_ppm)) +
  geom_point(aes()) +
  geom_pointrange(aes(ymin = lower.CL, ymax = upper.CL)) +
  geom_text(aes(label = .group), nudge_x = 0.08) +
  facet_grid(rows = vars(Depth)) +
  labs(title = "Dane", x = "sample timing", y = "soil nitrate (ppm)") +
  theme(legend.position = "none")
  

Dane_N_PPM
```

# Outagamie 1 - Sunny Daze
```{r}
Outagamie1_12 = lmer(N_ppm ~ Timing + (1|Rep), data = (filter(data1, County == "Outagamie 1", Depth == "0-12")))
Outagamie1_24 = lmer(N_ppm ~ Timing + (1|Rep), data = (filter(data1, County == "Outagamie 1", Depth == "12-24")))
```

```{r}
anova(Outagamie1_12)
#significant differences based on timing

anova(Outagamie1_24)
#significant differences based on timing
```

```{r}
Outagamie1_12_means = lsmeans(Outagamie1_12, ~ Timing, contr= "pairwise", adjust= "none")
Outagamie1_24_means = lsmeans(Outagamie1_24, ~ Timing, contr= "pairwise", adjust= "none")

Outagamie1_12_CLD = cld(Outagamie1_12_means$lsmeans,alpha=0.05, Letters=letters, sort=FALSE, reverse=FALSE)
Outagamie1_24_CLD = cld(Outagamie1_24_means$lsmeans,alpha=0.05, Letters=letters, sort=FALSE, reverse=FALSE)
```

```{r}
Outagamie1_12_CLD = Outagamie1_12_CLD %>%
  mutate(Depth = "0-12")

Outagamie1_24_CLD = Outagamie1_24_CLD %>%
  mutate(Depth = "12-24") 

Outagamie1_CLD = rbind(Outagamie1_12_CLD, Outagamie1_24_CLD)

Outagamie1_CLD = as_tibble(Outagamie1_CLD) %>% 
  rename(N_ppm = lsmean) %>%
  mutate(N_ppm = round(N_ppm,0),
         Timing = factor(Timing, c("Fall", "Spring", "Harvest")),
         Depth = factor(Depth, c("0-12", "12-24")),
         Location = "Outagamie 1")
```

```{r}
Outagamie1_N_PPM = Outagamie1_CLD %>%
  ggplot(aes(x= Timing, y= N_ppm)) +
  geom_point(aes()) +
  geom_pointrange(aes(ymin = lower.CL, ymax = upper.CL)) +
  geom_text(aes(label = .group), nudge_x = 0.08) +
  facet_grid(rows = vars(Depth)) +
  labs(title = "Outagamie 1", x = "sample timing", y = "soil nitrate (ppm)") +
  theme(legend.position = "none")
  

Outagamie1_N_PPM
```

# Door County
```{r}
Door_12 = lmer(N_ppm ~ Timing + (1|Rep), data = (filter(data1, County == "Door", Depth == "0-12")))
```

```{r}
anova(Door_12)
#significant differences based on timing
```

```{r}
Door_12_means = lsmeans(Door_12, ~ Timing, contr= "pairwise", adjust= "none")

Door_12_CLD = cld(Door_12_means$lsmeans,alpha=0.05, Letters=letters, sort=FALSE, reverse=FALSE)
```

```{r}
Door_12_CLD = Door_12_CLD %>%
  mutate(Depth = "0-12")

Door_CLD = as_tibble(Door_12_CLD) %>% 
  rename(N_ppm = lsmean) %>%
  mutate(N_ppm = round(N_ppm,0),
         Timing = factor(Timing, c("Fall", "Spring", "Harvest")),
         Depth = factor(Depth, c("0-12")),
         Location = "Door")
```

```{r}
Door_N_PPM = Door_CLD %>%
  ggplot(aes(x= Timing, y= N_ppm)) +
  geom_point(aes()) +
  geom_pointrange(aes(ymin = lower.CL, ymax = upper.CL)) +
  geom_text(aes(label = .group), nudge_x = 0.08) +
  facet_grid(rows = vars(Depth)) +
  labs(title = "Door", x = "sample timing", y = "soil nitrate (ppm)") +
  theme(legend.position = "none")
  

Door_N_PPM
```

# Outagamie 2 - Oneida Nation
```{r}
Outagamie2_12 = lmer(N_ppm ~ Timing + (1|Rep), data = (filter(data1, County == "Outagamie", Depth == "0-12")))
Outagamie2_24 = lmer(N_ppm ~ Timing + (1|Rep), data = (filter(data1, County == "Outagamie", Depth == "12-24")))
```

```{r}
anova(Outagamie2_12)
#significant differences based on timing

anova(Outagamie2_24)
#significant differences based on timing
```

```{r}
Outagamie2_12_means = lsmeans(Outagamie2_12, ~ Timing, contr= "pairwise", adjust= "none")
Outagamie2_24_means = lsmeans(Outagamie2_24, ~ Timing, contr= "pairwise", adjust= "none")

Outagamie2_12_CLD = cld(Outagamie2_12_means$lsmeans,alpha=0.05, Letters=letters, sort=FALSE, reverse=FALSE)
Outagamie2_24_CLD = cld(Outagamie2_24_means$lsmeans,alpha=0.05, Letters=letters, sort=FALSE, reverse=FALSE)
```

```{r}
Outagamie2_12_CLD = Outagamie2_12_CLD %>%
  mutate(Depth = "0-12")

Outagamie2_24_CLD = Outagamie2_24_CLD %>%
  mutate(Depth = "12-24") 

Outagamie2_CLD = rbind(Outagamie2_12_CLD, Outagamie2_24_CLD)

Outagamie2_CLD = as_tibble(Outagamie2_CLD) %>% 
  rename(N_ppm = lsmean) %>%
  mutate(N_ppm = round(N_ppm,0),
         Timing = factor(Timing, c("Fall", "Spring", "Harvest")),
         Depth = factor(Depth, c("0-12", "12-24")),
         Location = "Outagamie 2")
```

```{r}
Outagamie2_N_PPM = Outagamie2_CLD %>%
  ggplot(aes(x= Timing, y= N_ppm)) +
  geom_point(aes()) +
  geom_pointrange(aes(ymin = lower.CL, ymax = upper.CL)) +
  geom_text(aes(label = .group), nudge_x = 0.08) +
  facet_grid(rows = vars(Depth)) +
  labs(title = "Outagamie 2", x = "sample timing", y = "soil nitrate (ppm)") +
  theme(legend.position = "none")
  

Outagamie2_N_PPM
```

# Marathon
```{r}
Marathon_12 = lmer(N_ppm ~ Timing + (1|Rep), data = (filter(data1, County == "Marathon", Depth == "0-12")))
Marathon_24 = lmer(N_ppm ~ Timing + (1|Rep), data = (filter(data1, County == "Marathon", Depth == "12-24")))
```

```{r}
anova(Marathon_12)
#significant differences based on timing

anova(Marathon_24)
#no significant differences based on timing
```

```{r}
Marathon_12_means = lsmeans(Marathon_12, ~ Timing, contr= "pairwise", adjust= "none")
Marathon_24_means = lsmeans(Marathon_24, ~ Timing, contr= "pairwise", adjust= "none")

Marathon_12_CLD = cld(Marathon_12_means$lsmeans,alpha=0.05, Letters=letters, sort=FALSE, reverse=FALSE)
Marathon_24_CLD = cld(Marathon_24_means$lsmeans,alpha=0.05, Letters=letters, sort=FALSE, reverse=FALSE)
```

```{r}
Marathon_12_CLD = Marathon_12_CLD %>%
  mutate(Depth = "0-12")

Marathon_24_CLD = Marathon_24_CLD %>%
  mutate(Depth = "12-24") 

Marathon_CLD = rbind(Marathon_12_CLD, Marathon_24_CLD)

Marathon_CLD = as_tibble(Marathon_CLD) %>% 
  rename(N_ppm = lsmean) %>%
  mutate(N_ppm = round(N_ppm,0),
         Timing = factor(Timing, c("Fall", "Spring", "Harvest")),
         Depth = factor(Depth, c("0-12", "12-24")),
         Location = "Marathon")
```

# Oconto
```{r}
Oconto_12 = lmer(N_ppm ~ Timing + (1|Rep), data = (filter(data1, County == "Oconto", Depth == "0-12")))
Oconto_24 = lmer(N_ppm ~ Timing + (1|Rep), data = (filter(data1, County == "Oconto", Depth == "12-24")))
```

```{r}
anova(Oconto_12)
#significant differences based on timing

anova(Oconto_24)
#significant differences based on timing
```

```{r}
Oconto_12_means = lsmeans(Oconto_12, ~ Timing, contr= "pairwise", adjust= "none")
Oconto_24_means = lsmeans(Oconto_24, ~ Timing, contr= "pairwise", adjust= "none")

Oconto_12_CLD = cld(Oconto_12_means$lsmeans,alpha=0.05, Letters=letters, sort=FALSE, reverse=FALSE)
Oconto_24_CLD = cld(Oconto_24_means$lsmeans,alpha=0.05, Letters=letters, sort=FALSE, reverse=TRUE)
```

```{r}
Oconto_12_CLD = Oconto_12_CLD %>%
  mutate(Depth = "0-12")

Oconto_24_CLD = Oconto_24_CLD %>%
  mutate(Depth = "12-24") 

Oconto_CLD = rbind(Oconto_12_CLD, Oconto_24_CLD)

Oconto_CLD = as_tibble(Oconto_CLD) %>% 
  rename(N_ppm = lsmean) %>%
  mutate(N_ppm = round(N_ppm,0),
         Timing = factor(Timing, c("Fall", "Spring", "Harvest")),
         Depth = factor(Depth, c("0-12", "12-24")),
         Location = "Oconto")
```

# Dunn
```{r}
Dunn_12 = lmer(N_ppm ~ Timing + (1|Rep), data = (filter(data1, County == "Dunn", Depth == "0-12")))
Dunn_24 = lmer(N_ppm ~ Timing + (1|Rep), data = (filter(data1, County == "Dunn", Depth == "12-24")))
```

```{r}
anova(Dunn_12)
#significant differences based on timing

anova(Dunn_24)
#significant differences based on timing
```

```{r}
Dunn_12_means = lsmeans(Dunn_12, ~ Timing, contr= "pairwise", adjust= "none")
Dunn_24_means = lsmeans(Dunn_24, ~ Timing, contr= "pairwise", adjust= "none")

Dunn_12_CLD = cld(Dunn_12_means$lsmeans,alpha=0.05, Letters=letters, sort=FALSE, reverse=FALSE)
Dunn_24_CLD = cld(Dunn_24_means$lsmeans,alpha=0.05, Letters=letters, sort=FALSE, reverse=TRUE)
```

```{r}
Dunn_12_CLD = Dunn_12_CLD %>%
  mutate(Depth = "0-12")

Dunn_24_CLD = Dunn_24_CLD %>%
  mutate(Depth = "12-24") 

Dunn_CLD = rbind(Dunn_12_CLD, Dunn_24_CLD)

Dunn_CLD = as_tibble(Dunn_CLD) %>% 
  rename(N_ppm = lsmean) %>%
  mutate(N_ppm = round(N_ppm,0),
         Timing = factor(Timing, c("Fall", "Spring", "Harvest")),
         Depth = factor(Depth, c("0-12", "12-24")),
         Location = "Dunn")
```

# Figure for all locations
```{r}
all_sites = rbind(Dunn_CLD, Oconto_CLD, Marathon_CLD, Outagamie1_CLD, Outagamie2_CLD, Door_CLD, Dane_CLD)
```

```{r, fig.height = 8, fig.width = 11}
All_N_PPM = all_sites %>%
  ggplot(aes(x= Timing, y= N_ppm)) +
  geom_point(aes(), size = 5) +
  geom_pointrange(aes(ymin = lower.CL, ymax = upper.CL)) +
  geom_text(aes(label = .group), nudge_x = 0.26, size = 10) +
  facet_grid(rows = vars(Depth), cols = vars(Location)) +
  labs(title =, x = "sample timing", y = "soil nitrate (ppm)") +
  theme(legend.position = "none",
        axis.title.x = element_text(size = 50),
        axis.title.y = element_text(size = 50),
        axis.text.y = element_text(size = 30),
        axis.text.x = element_text(size = 30, angle = 45, hjust = 1),
        strip.text.x = element_text(size = 30),
        strip.text.y = element_text(size = 30))
  

All_N_PPM
```

